#!/usr/bin/env bash

# DAEMON pre-commit hook: lint and format

echo "Running pre-commit checks..."

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$')

if [ -z "$STAGED_FILES" ]; then
	echo "No TypeScript/JavaScript files staged, skipping checks."
	exit 0
fi

echo "Checking format..."
bun run format:check $STAGED_FILES
FORMAT_EXIT=$?

echo "Running linter..."
bun run lint $STAGED_FILES
LINT_EXIT=$?

if [ $FORMAT_EXIT -ne 0 ] || [ $LINT_EXIT -ne 0 ]; then
	echo ""
	echo "❌ Pre-commit checks failed!"
	echo ""
	echo "To fix formatting issues, run:"
	echo "  bun run format"
	echo ""
	echo "To fix lint issues, run:"
	echo "  bun run lint:fix"
	echo ""
	exit 1
fi

echo "✅ Pre-commit checks passed!"
exit 0
